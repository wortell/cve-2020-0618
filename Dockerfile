# Start from the latest golang base image
FROM golang:latest AS go

# Add maintainer info
LABEL maintainer="maarten.goet@wortell.nl"

# Set environment variables
ENV GOPATH /go
ENV PATH $GOPATH/bin:/usr/local/go/bin:$PATH

# Set the working directory inside the container
WORKDIR /honeypot

# Copy files
ADD . /honeypot

# Get the depedency
RUN go get -v -u github.com/gorilla/mux

# Generate self-signed certificate
RUN openssl genrsa -out server.key 2048
RUN openssl ecparam -genkey -name secp384r1 -out server.key
RUN openssl req -new -x509 -sha256 -key server.key -out server.crt -days 3650 -subj "/C=US/ST=Florida/L=Miami/O=Cargo Shippers Inc/OU=IT/CN=cargoshippers.online"

# Open up ports 80 and 443 to the outside world
EXPOSE 80 443

# Run the honeypot
CMD go run honeypot.go